{% extends 'game/includes/base.html' %}
{% block head_title %}ê²Œì„ ì‹œì‘{% endblock %}
{% block page_title %}ê²Œì„ ì‹œì‘{% endblock %}

{% block content %} 
    <div class="role-container">
        <!-- ê²Œì„ ì •ë³´ ì¹´ë“œ -->
        <div class="game-info-card">
            <div class="info-header">
                <div class="info-icon">ğŸ°</div>
                <h3 class="info-title">ê²Œì„ ì •ë³´</h3>
            </div>
            
            <div class="info-content">
                <div class="info-item">
                    <span class="info-label">ì„¸ì…˜ ID</span>
                    <span class="info-value session-id">{{ game_session.session_id }}</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">ê²Œì„ ì˜µì…˜</span>
                    <div class="info-options">
                        {% if game_session.option1 and game_session.option2 %}
                                                         <span class="option-badge percival">ğŸ›¡ï¸ í¼ì‹œë²Œ</span>
                             <span class="option-badge morgana">ğŸ¦¹â€â™€ï¸ ëª¨ë¥´ê°€ë‚˜</span>
                         {% elif game_session.option1 %}
                             <span class="option-badge percival">ğŸ›¡ï¸ í¼ì‹œë²Œ</span>
                         {% elif game_session.option2 %}
                             <span class="option-badge morgana">ğŸ¦¹â€â™€ï¸ ëª¨ë¥´ê°€ë‚˜</span>
                        {% else %}
                            <span class="option-badge none">ğŸ¯ ê¸°ë³¸ ê²Œì„</span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="info-item">
                    <span class="info-label">í˜„ì¬ í”Œë ˆì´ì–´</span>
                    <span class="info-value player-name">{{ player_nickname }}</span>
                </div>
                
                <div class="info-item composition-info">
                    <span class="info-label">ê²Œì„ êµ¬ì„±</span>
                    <div class="composition-summary">
                        {% with total_players=players_in_session|length %}
                        <div class="team-composition good-team">
                            <span class="team-header">ğŸ•Šï¸ ì„ ì¸ 
                                {% if total_players == 5 %}3{% elif total_players == 6 %}4{% elif total_players == 7 %}4{% elif total_players == 8 %}5{% elif total_players == 9 %}6{% elif total_players == 10 %}6{% else %}{{ total_players|add:"-2" }}{% endif %}ëª…
                            </span>
                            <span class="team-details">
                                (ë©€ë¦° 1ëª…{% if game_session.option1 %}, í¼ì‹œë²Œ 1ëª…{% endif %}{% if total_players == 5 %}{% if game_session.option1 %}, ì¼ë°˜ ì„ ì¸ 1ëª…{% else %}, ì¼ë°˜ ì„ ì¸ 2ëª…{% endif %}{% elif total_players == 6 %}{% if game_session.option1 %}, ì¼ë°˜ ì„ ì¸ 2ëª…{% else %}, ì¼ë°˜ ì„ ì¸ 3ëª…{% endif %}{% elif total_players == 7 %}{% if game_session.option1 %}, ì¼ë°˜ ì„ ì¸ 2ëª…{% else %}, ì¼ë°˜ ì„ ì¸ 3ëª…{% endif %}{% elif total_players >= 8 %}, ì¼ë°˜ ì„ ì¸ ì—¬ëŸ¬ëª…{% endif %})
                            </span>
                        </div>
                        <div class="team-composition evil-team">
                            <span class="team-header">ğŸ˜ˆ ì•…ì¸ 
                                {% if total_players == 5 %}2{% elif total_players == 6 %}2{% elif total_players == 7 %}3{% elif total_players == 8 %}3{% elif total_players == 9 %}3{% elif total_players == 10 %}4{% else %}2{% endif %}ëª…
                            </span>
                            <span class="team-details">
                                (ì•”ì‚´ì 1ëª…{% if game_session.option2 %}, ëª¨ë¥´ê°€ë‚˜ 1ëª…{% endif %}{% if total_players == 5 %}{% if not game_session.option2 %}, ì¼ë°˜ ì•…ì¸ 1ëª…{% endif %}{% elif total_players == 6 %}{% if not game_session.option2 %}, ì¼ë°˜ ì•…ì¸ 1ëª…{% endif %}{% elif total_players == 7 %}{% if game_session.option2 %}, ì¼ë°˜ ì•…ì¸ 1ëª…{% else %}, ì¼ë°˜ ì•…ì¸ 2ëª…{% endif %}{% elif total_players >= 8 %}, ì¼ë°˜ ì•…ì¸ ì—¬ëŸ¬ëª…{% endif %})
                            </span>
                        </div>
                        {% endwith %}
                    </div>
                </div>
            </div>
        </div>

        <!-- í”Œë ˆì´ì–´ ëª©ë¡ ì¹´ë“œ -->
        <div class="players-card">
            <div class="players-header">
                <div class="players-icon">ğŸ‘¥</div>
                <h3 class="players-title">ì°¸ì—¬ í”Œë ˆì´ì–´</h3>
                <div class="players-count">{{ players_in_session|length }}ëª…</div>
            </div>
            
            <div class="players-content">
                <div class="player-grid">
                    {% for player_obj in players_in_session %}
                    <div class="player-item-compact">
                        <div class="player-avatar-small">ğŸ‘¤</div>
                        <div class="player-nickname-compact">{{ player_obj.nickname }}</div>
                        {% if player_obj.nickname == game_session.host_nickname %}
                            <div class="player-host-badge-small">ğŸ‘‘</div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- ì—­í•  ì •ë³´ ì¹´ë“œ -->
        <div class="role-card">
            <div class="role-header">
                <div class="role-header-icon">ğŸ­</div>
                <h3 class="role-title">ë‹¹ì‹ ì˜ ì—­í• </h3>
            </div>
            
            <div class="role-content">
                <div class="role-image-container">
                    <img src="{{ player.role_image }}" alt="{{ player.role }}" class="role-image">
                </div>
                
                <div class="role-intro">
                    <h4 class="role-name-display">{{ player.role_intro }}</h4>
                </div>
                
                <div class="role-description">
                    <p>{{ role_detail|linebreaksbr }}</p>
                </div>
            </div>
        </div>

        <!-- í˜¸ìŠ¤íŠ¸ ì•¡ì…˜ ì¹´ë“œ (í˜¸ìŠ¤íŠ¸ë§Œ ë³´ì„) -->
        {% if player_nickname == game_session.host_nickname %}
        <div class="host-actions-card danger">
            <div class="host-header">
                <div class="host-icon">ğŸ›‘</div>
                <h3 class="host-title">ê²Œì„ ê´€ë¦¬</h3>
                <div class="host-badge">í˜¸ìŠ¤íŠ¸</div>
            </div>
            
            <div class="host-content">
                <p class="end-description">ê²Œì„ì„ ì¤‘ë‹¨í•˜ê³  ì‹¶ìœ¼ì‹œë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</p>
                <form id="end-game-form" method="post" action="{% url 'end_game' game_session.session_id %}">
                    {% csrf_token %}
                    <input type="hidden" name="nickname" value="{{ player_nickname }}">
                    <input type="hidden" name="pin" value="{{ player_pin }}">
                    <button type="submit" class="end-game-btn" onclick="return confirm('ì •ë§ë¡œ ê²Œì„ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                        <span class="btn-icon">ğŸ›‘</span>
                        <span class="btn-text">ê²Œì„ ì¢…ë£Œ</span>
                    </button>
                </form>
            </div>
        </div>
        {% endif %}
    </div>
{% endblock %}