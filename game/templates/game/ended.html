{% extends 'game/includes/base.html' %}
{% block head_title %}ê²Œì„ ì¢…ë£Œ{% endblock %}
{% block page_title %}ê²Œì„ ì¢…ë£Œ{% endblock %}

{% block content %}
    <div class="ended-container">
        <!-- ê²Œì„ ì •ë³´ ì¹´ë“œ -->
        <div class="game-info-card">
            <div class="info-header">
                <div class="info-icon">ğŸ°</div>
                <h3 class="info-title">ê²Œì„ ì •ë³´</h3>
            </div>
            
            <div class="info-content">
                <div class="info-item">
                    <span class="info-label">ì„¸ì…˜ ID</span>
                    <span class="info-value session-id">{{ game_session.session_id }}</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">ê²Œì„ ì˜µì…˜</span>
                    <div class="info-options">
                        {% if game_session.option1 and game_session.option2 %}
                                                         <span class="option-badge percival">ğŸ›¡ï¸ í¼ì‹œë²Œ</span>
                             <span class="option-badge morgana">ğŸ¦¹â€â™€ï¸ ëª¨ë¥´ê°€ë‚˜</span>
                         {% elif game_session.option1 %}
                             <span class="option-badge percival">ğŸ›¡ï¸ í¼ì‹œë²Œ</span>
                         {% elif game_session.option2 %}
                             <span class="option-badge morgana">ğŸ¦¹â€â™€ï¸ ëª¨ë¥´ê°€ë‚˜</span>
                        {% else %}
                            <span class="option-badge none">ğŸ¯ ê¸°ë³¸ ê²Œì„</span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="info-item">
                    <span class="info-label">í˜„ì¬ í”Œë ˆì´ì–´</span>
                    <span class="info-value player-name">{{ player_nickname|default:"ì•Œ ìˆ˜ ì—†ìŒ" }}</span>
                </div>
                
                {% if player_nickname %}
                <div class="info-item">
                    <span class="info-label">ë‚˜ì˜ ì—­í• </span>
                    <div class="my-role-info">
                        {% for player_obj in players_in_session %}
                            {% if player_obj.nickname == player_nickname %}
                                {% if player_obj.role == "good" %}
                                    <span class="role-badge role-good">ğŸ•Šï¸ ì„ ì¸</span>
                                {% elif player_obj.role == "merlin" %}
                                    <span class="role-badge role-merlin">ğŸ§™â€â™‚ï¸ ë©€ë¦°</span>
                                {% elif player_obj.role == "percival" %}
                                    <span class="role-badge role-percival">ğŸ›¡ï¸ í¼ì‹œë²Œ</span>
                                {% elif player_obj.role == "bad" %}
                                    <span class="role-badge role-bad">ğŸ˜ˆ ì•…ì¸</span>
                                {% elif player_obj.role == "assassin" %}
                                    <span class="role-badge role-assassin">ğŸ—¡ï¸ ì•”ì‚´ì</span>
                                {% elif player_obj.role == "morgana" %}
                                    <span class="role-badge role-morgana">ğŸ¦¹â€â™€ï¸ ëª¨ë¥´ê°€ë‚˜</span>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- ê²Œì„ ì¢…ë£Œ ë©”ì‹œì§€ ì¹´ë“œ -->
        <div class="game-end-message-card">
            <div class="end-message-header">
                <div class="end-message-icon">ğŸ­</div>
                <h3 class="end-message-title">ê²Œì„ ê²°ê³¼</h3>
            </div>
            
            <div class="end-message-content">
                <p class="end-message-text">{{ message }}</p>
            </div>
        </div>

        <!-- ì—­í•  ê³µê°œ ì¹´ë“œ -->
        {% if game_session.is_started %}
        <div class="roles-reveal-card">
            <div class="roles-header">
                <div class="roles-icon">ğŸª</div>
                <h3 class="roles-title">ì—­í•  ê³µê°œ</h3>
                <div class="roles-count">{{ players_in_session|length }}ëª…</div>
            </div>
            
            <div class="roles-content">
                <div class="roles-grid">
                    <!-- 1. ì•”ì‚´ì -->
                    {% for player in players_in_session %}
                        {% if player.role == 'assassin' %}
                        <div class="role-reveal-item evil-side">
                            <div class="player-role-avatar">
                                <img src="{{ player.role_image }}" alt="{{ player.role }}" class="role-reveal-image">
                            </div>
                            
                            <div class="player-role-info">
                                <div class="player-role-nickname">{{ player.nickname }}</div>
                                <div class="player-role-name">
                                    <span class="role-badge role-assassin">ğŸ—¡ï¸ ì•”ì‚´ì</span>
                                </div>
                            </div>
                            
                            {% if player.nickname == game_session.host_nickname %}
                                <div class="player-host-badge-small">ğŸ‘‘</div>
                            {% endif %}
                        </div>
                        {% endif %}
                    {% endfor %}
                    
                    <!-- 2. ëª¨ë¥´ê°€ë‚˜ -->
                    {% for player in players_in_session %}
                        {% if player.role == 'morgana' %}
                        <div class="role-reveal-item evil-side">
                            <div class="player-role-avatar">
                                <img src="{{ player.role_image }}" alt="{{ player.role }}" class="role-reveal-image">
                            </div>
                            
                            <div class="player-role-info">
                                <div class="player-role-nickname">{{ player.nickname }}</div>
                                <div class="player-role-name">
                                    <span class="role-badge role-morgana">ğŸ¦¹â€â™€ï¸ ëª¨ë¥´ê°€ë‚˜</span>
                                </div>
                            </div>
                            
                            {% if player.nickname == game_session.host_nickname %}
                                <div class="player-host-badge-small">ğŸ‘‘</div>
                            {% endif %}
                        </div>
                        {% endif %}
                    {% endfor %}
                    
                    <!-- 3. ì•…ì¸ -->
                    {% for player in players_in_session %}
                        {% if player.role == 'bad' %}
                        <div class="role-reveal-item evil-side">
                            <div class="player-role-avatar">
                                <img src="{{ player.role_image }}" alt="{{ player.role }}" class="role-reveal-image">
                            </div>
                            
                            <div class="player-role-info">
                                <div class="player-role-nickname">{{ player.nickname }}</div>
                                <div class="player-role-name">
                                    <span class="role-badge role-bad">ğŸ˜ˆ ì•…ì¸</span>
                                </div>
                            </div>
                            
                            {% if player.nickname == game_session.host_nickname %}
                                <div class="player-host-badge-small">ğŸ‘‘</div>
                            {% endif %}
                        </div>
                        {% endif %}
                    {% endfor %}
                    
                    <!-- 4. ë©€ë¦° -->
                    {% for player in players_in_session %}
                        {% if player.role == 'merlin' %}
                        <div class="role-reveal-item good-side">
                            <div class="player-role-avatar">
                                <img src="{{ player.role_image }}" alt="{{ player.role }}" class="role-reveal-image">
                            </div>
                            
                            <div class="player-role-info">
                                <div class="player-role-nickname">{{ player.nickname }}</div>
                                <div class="player-role-name">
                                    <span class="role-badge role-merlin">ğŸ§™â€â™‚ï¸ ë©€ë¦°</span>
                                </div>
                            </div>
                            
                            {% if player.nickname == game_session.host_nickname %}
                                <div class="player-host-badge-small">ğŸ‘‘</div>
                            {% endif %}
                        </div>
                        {% endif %}
                    {% endfor %}
                    
                    <!-- 5. í¼ì‹œë²Œ -->
                    {% for player in players_in_session %}
                        {% if player.role == 'percival' %}
                        <div class="role-reveal-item good-side">
                            <div class="player-role-avatar">
                                <img src="{{ player.role_image }}" alt="{{ player.role }}" class="role-reveal-image">
                            </div>
                            
                            <div class="player-role-info">
                                <div class="player-role-nickname">{{ player.nickname }}</div>
                                <div class="player-role-name">
                                    <span class="role-badge role-percival">ğŸ›¡ï¸ í¼ì‹œë²Œ</span>
                                </div>
                            </div>
                            
                            {% if player.nickname == game_session.host_nickname %}
                                <div class="player-host-badge-small">ğŸ‘‘</div>
                            {% endif %}
                        </div>
                        {% endif %}
                    {% endfor %}
                    
                    <!-- 6. ì„ ì¸ -->
                    {% for player in players_in_session %}
                        {% if player.role == 'good' %}
                        <div class="role-reveal-item good-side">
                            <div class="player-role-avatar">
                                <img src="{{ player.role_image }}" alt="{{ player.role }}" class="role-reveal-image">
                            </div>
                            
                            <div class="player-role-info">
                                <div class="player-role-nickname">{{ player.nickname }}</div>
                                <div class="player-role-name">
                                    <span class="role-badge role-good">ğŸ•Šï¸ ì„ ì¸</span>
                                </div>
                            </div>
                            
                            {% if player.nickname == game_session.host_nickname %}
                                <div class="player-host-badge-small">ğŸ‘‘</div>
                            {% endif %}
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- ìƒˆ ê²Œì„ ì¶”ì²œ ì¹´ë“œ -->
        <div class="new-game-card">
            <div class="new-game-content">
                <div class="new-game-icon">ğŸ®</div>
                <h3 class="new-game-title">ìƒˆë¡œìš´ ê²Œì„ì„ ì‹œì‘í•´ë³´ì„¸ìš”!</h3>
                <p class="new-game-description">ë‹¤ì‹œ í•œ ë²ˆ ì•„ë°œë¡ ì˜ ì„¸ê³„ë¡œ ë– ë‚˜ë³´ì‹œê² ì–´ìš”?</p>
                <a href="{% url 'home' %}" class="new-game-btn">
                    <span class="btn-icon">ğŸš€</span>
                    <span class="btn-text">ìƒˆ ê²Œì„ ë§Œë“¤ê¸°</span>
                </a>
            </div>
        </div>
        {% endif %}
    </div>
{% endblock %}